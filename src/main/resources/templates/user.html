<!DOCTYPE html>
<html lang="en">

<head>

    <title>个人主页</title>
    <link rel="dns-prefetch" href="//p0.meituan.net"/>
    <link rel="dns-prefetch" href="//p1.meituan.net"/>
    <link rel="dns-prefetch" href="//ms0.meituan.net"/>
    <link rel="dns-prefetch" href="//ms1.meituan.net"/>
    <link rel="dns-prefetch" href="//analytics.meituan.com"/>
    <link rel="dns-prefetch" href="//report.meituan.com"/>
    <link rel="dns-prefetch" href="//frep.meituan.com"/>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta charset="utf-8">
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta http-equiv="cleartype" content="yes"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="renderer" content="webkit"/>

    <meta name="HandheldFriendly" content="true"/>
    <meta name="format-detection" content="email=no"/>
    <meta name="format-detection" content="telephone=no"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
    <!--js 操作cookie文件的操作-->
    <script src="https://cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.js"></script>

    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"
            integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
            crossorigin="anonymous">
        <
        script > "use strict";
        !function () {
            var i = 0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : "_Owl_", n = window;
            n[i] || (n[i] = {
                isRunning: !1, isReady: !1, preTasks: [], dataSet: [], use: function (i, t) {
                    this.isReady && n.Owl && n.Owl[i](t), this.preTasks.push({api: i, data: [t]})
                }, add: function (i) {
                    this.dataSet.push(i)
                }, run: function () {
                    var t = this;
                    if (!this.isRunning) {
                        this.isRunning = !0;
                        var i = n.onerror;
                        n.onerror = function () {
                            this.isReady || this.add({type: "jsError", data: arguments}), i && i.apply(n, arguments)
                        }.bind(this), (n.addEventListener || n.attachEvent)("error", function (i) {
                            t.isReady || t.add({type: "resError", data: [i]})
                        }, !0)
                    }
                }
            }, n[i].run())
        }();</script>
    <script>
        cid = "c_6jadt9m";
        ci = 91;
        window.system = {};

        window.openPlatform = '';
        window.openPlatformSub = '';
    </script>
    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
          crossorigin="anonymous">
    <link rel="stylesheet" href="/static/css/profile.css"/>
    <script crossorigin="anonymous" src="/static/js/stat.js"></script>
    <script>if (window.devicePixelRatio >= 2) {
        document.write('<link rel="stylesheet" href="//ms0.meituan.net/mywww/image-2x.8ba7074d.css"/>')
    }</script>

    <script>
        $(document).ready(function () {
            function login_user() {
                let username = $.cookie('username');

                if (username == null) {
                    console.log("获取用户的用户名失败");
                    return;
                }
                let user_id = $.cookie('user_id');

                if (user_id == null) {
                    console.log("获取用户的id失败")
                    return;
                }

                console.log("username " + username + " user_id " + user_id);
                // 移除登陆注册的按钮
                $(".login-out").remove();
                // 增加用户的超链接
                // 连接到一个用户的模板
                $(".user-operation").append(`
  <li >
            <a href="/user/tpl"> ${username} </a>
        </li>
  `);

                // 退出登陆按钮
                $(".user-operation").append(`
  <li >
            <a href="/user/loginOut"> 退出登陆 </a>
        </li>
  `);

            }

            login_user();
        })
    </script>
    <style>
        .radius-default {
            border-radius: 28px
        }

        .navbar-default {
            height: 56x;;
        }

        .margin-right-default {
            margin-right: -24px;
        }

        .w-h-28 {
            height: 34px;
            width: 34px;
            text-align: center;
        }
    </style>

    <script>
        $(document).ready(function () {

            $(".inav li").click(function () {
                //    移除所有的 active
                $(".inav li").removeClass("active");
                // 设置当前点击对象的class 值为active
                $(this).addClass("active")
            })
        });
    </script>

</head>

<body>

<!-- 固定导航条navbar-fixed-top-->
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <div class="navbar-header">

            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#example-navbar-collapse">
                <span class="sr-only">切换导航</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">
                <!--<img id="logoImg" src="/static/image/logo.png">-->
            </a>
        </div>
        <div class="collapse navbar-collapse" id="example-navbar-collapse">
            <ul class="nav navbar-nav inav">
                <li><a href="/" class="">首页</a></li>
                <li><a href="/films" class="">电影</a></li>
                <li><a href="/board" class="">榜单</a></li>
                <!--<li><a href="#" class="">热点</a></li>-->

            </ul>

            <form action="##" class="navbar-form navbar-right">
                <div class="form-group radius-default">
                    <input type="text" class="form-control radius-default  margin-right-default" placeholder="找电影 影人 "/>
                    <button type="submit" class="btn  radius-default w-h-28" aria-hidden="true"></span>
                    </button>

                </div>
            </form>

            <ul class="nav navbar-nav navbar-right user-operation">
                <li class="login-out">
                    <a href="/user/login">登录</a>
                </li>
                <li class="login-out"><a href="" class="disable">|</a></li>
                <li class="login-out"><a href="/user/reg">注册</a></li>

            </ul>
        </div>
    </div>
    <!-- <div class="nav navbar-nav navbar-right">
          <img src="image/user.png">
          <ul>
            <li>
              <a href="/profile/comment">我的影评</a>
            </li>
            <li class="text login-name" title="dUH234053738"><a href="javascript:void 0">基本信息</a></li>
            <li><a href="javascript:void 0" class="J-logout" data-act="logout-click">退出登录</a></li>
          </ul>
        </div>
    </div> -->
</nav>
<div class="container page-profile/profile" id="app">
    <div class="content">
        <div class="main">
            <div class="info-content clearfix">
                <div class="user-profile-nav">
                    <h1>个人中心</h1>
                    <a href="/user/comment" class="comment ">我的影评</a>
                    <a href="/user/tpl" class="profile active">基本信息</a>
                </div>
                <div class="profile-container">
                    <div class="profile-title">
                        基本信息
                    </div>
                    <div class="avatar-container">
                        <div class="avatar-content">
                            <img class="J-setted-avatar" src="/static/image/buser.png">
                            <div class="J-upload-avatar-w upload-avatar-image">
                                <input type="button" class="J-upload-avatar upload-btn" value="更换头像">
                                <input type="file" id="fileUpload" name="file"/>

                            </div>
                            <div class="tips">支持JPG,JPEG,PNG格式,且文件需小于1M</div>
                        </div>
                    </div>
                    <script>
                        $(document).ready(function () {
                            // 用户名
                            let form_username = $("#userexinfo-form-username");
                            form_username.val($.cookie("username"));
                            // 密码
                            let form_password = $("#userexinfo-form-password");
                            // 手机号码
                            let form_phone = $("#userexinfo-form-phone");
                            // 电子邮件
                            let form_email = $("#userexinfo-form-email");

                            //
                            let regPhone = /^(13[0-9]|14[5|7]|15[0|1|2|3|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])\d{8}$/;
                            let regMail = /^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/;

                            // 保存事件
                            $("#input-save").click(function () {
                                console.log("hahaha");
                                let user_id = $.cookie("user_id");
                                var phone = form_phone.val();
                                let email = form_email.val();
                                let username = form_username.val();
                                let password = form_password.val(); // 用户密码

                                // 验证手机号码
                                let ok = regPattern(regPhone, phone);
                                if (!ok) {
                                    alert("手机号码不正确");
                                    return;
                                }

                                // 验证电子邮箱
                                ok = regPattern(regMail, email);
                                if (!ok) {
                                    alert("电子邮箱不正确");
                                    return;
                                }

                                //  验证密码不正确
                                if (password.length < 8) {
                                    alert("用户名密码不正确");
                                    return;
                                }
                                // 验证  用户名
                                if (username.length < 8 || username.length > 16) {
                                    alert("用户名不正确");
                                    return;
                                }

                                console.log("username " + username + " phone " + phone + "  email " + email);

                                let url = "/user/modify";
                                let data = {"phone": phone, "password": password, "email": email, "id": user_id,"username":form_username.val()};
                                console.log("data" + JSON.stringify(data));
                                $.post(url, data, function (data, res) {
                                    console.log("dasta" + data);

                                    if (data.code == 200) {
                                        form_password.val("");
                                        form_phone.val("");
                                        form_email.val(""); // 重置数据项
                                        alert("修改信息成功");
                                    } else {
                                        alert("修改用户数据失败");

                                    }
                                })
                            });

                        });

                        // 正则表达式验证手机号码和密码
                        function regPattern(pattern, text) {
                            return pattern.test(text);
                        }
                    </script>

                    <form id="J-userexinfo-form" class="userexinfo-form">
                        <div class="userexinfo-form-section">
                            <p>用户名：</p>
                            <span>
                                    <input type="text" name="username" id="userexinfo-form-username" class="ui-checkbox"
                                           placeholder="2-15个字，支持中英文、数字">
                                </span>
                        </div>
                        <div class="userexinfo-form-section">
                            <p>密码：</p>
                            <span>
                                    <input type="password" name="password" id="userexinfo-form-password"
                                           class="ui-checkbox">
                                </span>
                        </div>
                        <div class="userexinfo-form-section">
                            <p>邮箱：</p>
                            <span>
                                    <input type="text" name="email" id="userexinfo-form-email" class="ui-checkbox">
                                </span>
                        </div>
                        <div class="userexinfo-form-section">
                            <p>手机号：</p>
                            <span>
                                    <input type="text" name="phone" id="userexinfo-form-phone" class="ui-checkbox">
                                </span>
                        </div>

                        <input type="hidden" name="csrf"
                               value="17ba125274915b3a6c1449295fc29682df1fb25f2038aa478d5915fd39c39d3b">
                        <div class="userexinfo-bottom-section clearfix">
                            <input type="button" id="input-save" class="form-save-btn" value="保存">
                            <!-- <span id="cancell-btn" class="cancel_alert hand">注销账号1</span> -->
                        </div>
                    </form>


                    <script crossorigin="anonymous" src="/static/js/owl_1.7.11.js"></script>
                    <script>
                        Owl.start({
                            project: 'com.sankuai.movie.fe.mywww',
                            pageUrl: location.href.split('?')[0].replace(/\/\d+/g, '/:id'),
                            devMode: false
                        })
                        // 单独自定义上报下img加载错误
                        window.addEventListener('error', function (e) {
                            var node = e.target || e.srcElement
                            try {
                                var msg = node.src || node.href
                                var nodeName = node.nodeName
                                if (nodeName && nodeName.toLowerCase() === 'img') {
                                    Owl.addError(msg, {level: 'warn', category: 'resourceError'})
                                }
                            } catch (err) {
                                console.error(err)
                            }
                        }, true)
                    </script>


</body>

</html>